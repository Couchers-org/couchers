import json
from unittest.mock import patch

import pytest
from google.protobuf import empty_pb2

import couchers.servicers.donations
from couchers.config import config
from couchers.db import session_scope
from couchers.jobs.handlers import update_badges
from couchers.models import DonationInitiation, DonationType, Invoice, UserBadge
from couchers.sql import couchers_select as select
from proto import donations_pb2
from proto.google.api import httpbody_pb2
from tests.test_fixtures import db, donations_session, generate_user, real_stripe_session, testconfig  # noqa


@pytest.fixture(autouse=True)
def _(testconfig):
    pass


def test_one_time_donation_flow(db, monkeypatch):
    user, token = generate_user()
    user_email = user.email
    user_id = user.id

    new_config = config.copy()
    new_config["ENABLE_DONATIONS"] = True
    new_config["STRIPE_API_KEY"] = "dummy_api_key"
    new_config["STRIPE_WEBHOOK_SECRET"] = "dummy_webhook_secret"
    new_config["STRIPE_RECURRING_PRODUCT_ID"] = "price_1KIbmbIfR5z29g5kFWPEUnC6"

    monkeypatch.setattr(couchers.servicers.donations, "config", new_config)

    ## User first makes a req to Donations.InitiateDonation
    with donations_session(token) as donations:
        with patch("couchers.servicers.donations.stripe") as mock:
            mock.Customer.create.return_value = type("__MockCustomer", (), {"id": "cus_Pv4uq0gT0rDZWN"})
            mock.checkout.Session.create.return_value = type("__MockCheckoutSession", (), one_time_STRIPE_SESSION)

            res = donations.InitiateDonation(
                donations_pb2.InitiateDonationReq(
                    amount=100,
                    recurring=False,
                )
            )

        mock.Customer.create.assert_called_once_with(
            email=user_email, metadata={"user_id": user_id}, api_key="dummy_api_key"
        )

        mock.checkout.Session.create.assert_called_once_with(
            client_reference_id=user_id,
            submit_type="donate",
            customer="cus_Pv4uq0gT0rDZWN",
            success_url="http://localhost:3000/donate?success=true",
            cancel_url="http://localhost:3000/donate?cancelled=true",
            payment_method_types=["card"],
            mode="payment",
            line_items=[
                {
                    "price_data": {
                        "currency": "usd",
                        "unit_amount": 10000,
                        "product_data": {
                            "name": f"Couchers financial supporter (one-time)",
                            "images": ["https://couchers.org/img/share.jpg"],
                        },
                    },
                    "quantity": 1,
                }
            ],
            api_key="dummy_api_key",
        )

    ## Stripe then makes some webhooks requests

    # evt_1P5EkZIfR5z29g5kRH0e4NVx:customer.created
    fire_stripe_event("evt_1P5EkZIfR5z29g5kRH0e4NVx")

    # evt_3P5El3IfR5z29g5k0TLWlfHq:charge.succeeded
    fire_stripe_event("evt_3P5El3IfR5z29g5k0TLWlfHq")

    # evt_1P5El5IfR5z29g5kNedLGqCz:checkout.session.completed
    fire_stripe_event("evt_1P5El5IfR5z29g5kNedLGqCz")

    # evt_3P5El3IfR5z29g5k0tueVWGH:payment_intent.succeeded
    fire_stripe_event("evt_3P5El3IfR5z29g5k0tueVWGH")

    # evt_3P5El3IfR5z29g5k0mFVJ2V7:payment_intent.created
    fire_stripe_event("evt_3P5El3IfR5z29g5k0mFVJ2V7")

    ## Now finally check everything was added to the DB
    with session_scope() as session:
        donation = session.execute(select(DonationInitiation)).scalar_one()
        assert donation.user_id == user_id
        assert donation.amount == 100
        assert (
            donation.stripe_checkout_session_id == "cs_test_a12ftevGwzCAa236NeLPq6yRAdMt0V2S1gGjFcxfsY4xT4tiREPvbr5lhG"
        )
        assert donation.donation_type == DonationType.one_time

        invoice = session.execute(select(Invoice)).scalar_one()
        assert invoice.user_id == user_id
        assert invoice.amount == 100
        assert invoice.stripe_payment_intent_id == "pi_3P5El3IfR5z29g5k0N5TNa7R"
        assert (
            invoice.stripe_receipt_url
            == "https://pay.stripe.com/receipts/payment/CAcaFwoVYWNjdF8xS0V6QnlJZlI1ejI5ZzVrKIqF7LAGMgbtNxpJulk6LBaePNy_2Q2RzXJsbk7t1jLwK26AQlG05P-4EPhG7AIIcqsQLgC09iDJ2srs"
        )

    # check they get a badge
    update_badges(empty_pb2.Empty())
    with session_scope() as session:
        assert (
            session.execute(select(UserBadge).where(UserBadge.user_id == user_id, UserBadge.badge_id == "donor"))
            .scalar_one()
            .user_id
            == user_id
        )


def test_recurring_donation_flow(db, monkeypatch):
    user, token = generate_user()
    user_email = user.email
    user_id = user.id

    new_config = config.copy()
    new_config["ENABLE_DONATIONS"] = True
    new_config["STRIPE_API_KEY"] = "dummy_api_key"
    new_config["STRIPE_WEBHOOK_SECRET"] = "dummy_webhook_secret"
    new_config["STRIPE_RECURRING_PRODUCT_ID"] = "price_1IRoHdE5kUmYuPWz9tX8UpRv"

    monkeypatch.setattr(couchers.servicers.donations, "config", new_config)

    ## User first makes a req to Donations.InitiateDonation
    with donations_session(token) as donations:
        with patch("couchers.servicers.donations.stripe") as mock:
            mock.Customer.create.return_value = type("__MockCustomer", (), {"id": "cus_Pv4w8dxBpTVUsQ"})
            mock.checkout.Session.create.return_value = type("__MockCheckoutSession", (), RECURRING_STRIPE_SESSION)

            res = donations.InitiateDonation(
                donations_pb2.InitiateDonationReq(
                    amount=25,
                    recurring=True,
                )
            )

        mock.Customer.create.assert_called_once_with(
            email=user_email, metadata={"user_id": user_id}, api_key="dummy_api_key"
        )

        mock.checkout.Session.create.assert_called_once_with(
            client_reference_id=user_id,
            customer="cus_Pv4w8dxBpTVUsQ",
            submit_type=None,
            success_url="http://localhost:3000/donate?success=true",
            cancel_url="http://localhost:3000/donate?cancelled=true",
            payment_method_types=["card"],
            mode="subscription",
            line_items=[
                {
                    "price": "price_1IRoHdE5kUmYuPWz9tX8UpRv",
                    "quantity": 25,
                }
            ],
            api_key="dummy_api_key",
        )

    ## Stripe then makes some webhooks requests

    # evt_1P5EmWIfR5z29g5kdOMc8bxr: customer.created
    fire_stripe_event("evt_1P5EmWIfR5z29g5kdOMc8bxr")

    # evt_3P5EmzIfR5z29g5k0bA1H9Vg: charge.succeeded
    fire_stripe_event("evt_3P5EmzIfR5z29g5k0bA1H9Vg")

    # evt_1P5En1IfR5z29g5k89Az23Na: payment_method.attached
    fire_stripe_event("evt_1P5En1IfR5z29g5k89Az23Na")

    # evt_1P5En1IfR5z29g5kh279xFFB: customer.updated
    fire_stripe_event("evt_1P5En1IfR5z29g5kh279xFFB")

    # evt_1P5En2IfR5z29g5khvLimtc3: customer.subscription.created
    fire_stripe_event("evt_1P5En2IfR5z29g5khvLimtc3")

    # evt_1P5En2IfR5z29g5kQ3f7d9C6: customer.subscription.updated
    fire_stripe_event("evt_1P5En2IfR5z29g5kQ3f7d9C6")

    # evt_3P5EmzIfR5z29g5k0taFsMsl: payment_intent.succeeded
    fire_stripe_event("evt_3P5EmzIfR5z29g5k0taFsMsl")

    # evt_3P5EmzIfR5z29g5k0bxxQl9f: payment_intent.created
    fire_stripe_event("evt_3P5EmzIfR5z29g5k0bxxQl9f")

    # evt_1P5En2IfR5z29g5kQZBnH8bR: invoice.created
    fire_stripe_event("evt_1P5En2IfR5z29g5kQZBnH8bR")

    # evt_1P5En2IfR5z29g5kGrG7cxm7: invoice.finalized
    fire_stripe_event("evt_1P5En2IfR5z29g5kGrG7cxm7")

    # evt_1P5En3IfR5z29g5kRKYnPpgc: invoice.updated
    fire_stripe_event("evt_1P5En3IfR5z29g5kRKYnPpgc")

    # evt_1P5En3IfR5z29g5kXDrXUkQa: invoice.paid
    fire_stripe_event("evt_1P5En3IfR5z29g5kXDrXUkQa")

    # evt_1P5En3IfR5z29g5k3ElqoMso: invoice.payment_succeeded
    fire_stripe_event("evt_1P5En3IfR5z29g5k3ElqoMso")

    # evt_1P5En3IfR5z29g5kOoaABPf4: checkout.session.completed
    fire_stripe_event("evt_1P5En3IfR5z29g5kOoaABPf4")

    ## Now finally check everything was added to the DB
    with session_scope() as session:
        donation = session.execute(select(DonationInitiation)).scalar_one()
        assert donation.user_id == user_id
        assert donation.amount == 25
        assert (
            donation.stripe_checkout_session_id == "cs_test_a1JoMu1FbksL058ob6T6AC1byYR2DCXVRwi0ybLSZKwINYe868OQr25qaC"
        )
        assert donation.donation_type == DonationType.recurring

        invoice = session.execute(select(Invoice)).scalar_one()
        assert invoice.user_id == user_id
        assert invoice.amount == 25
        assert invoice.stripe_payment_intent_id == "pi_3P5EmzIfR5z29g5k0uVvI3kX"
        assert (
            invoice.stripe_receipt_url
            == "https://pay.stripe.com/receipts/invoices/CAcaFwoVYWNjdF8xS0V6QnlJZlI1ejI5ZzVrKIOG7LAGMgYTBIebo2c6LBYFs4BgdV7T4S5nHXQyHt4uh5azZ3_ss_S2wi27m52wbg4yQAoirZ9eBhbH?s=ap"
        )

    # check they get a badge
    update_badges(empty_pb2.Empty())
    with session_scope() as session:
        assert (
            session.execute(select(UserBadge).where(UserBadge.user_id == user_id, UserBadge.badge_id == "donor"))
            .scalar_one()
            .user_id
            == user_id
        )


def fire_stripe_event(event_id):
    event = json.loads(STRIPE_WEBHOOK_EVENTS[event_id])
    with real_stripe_session() as api:
        with patch("couchers.servicers.donations.stripe") as mock:
            mock.Webhook.construct_event.return_value = event
            reply = api.Webhook(
                httpbody_pb2.HttpBody(content_type="application/json", data=b"{}"),
                metadata=(("stripe-signature", "dummy_sig"),),
            )
        mock.Webhook.construct_event.assert_called_once_with(
            payload=b"{}", sig_header="dummy_sig", secret="dummy_webhook_secret", api_key="dummy_api_key"
        )


STRIPE_WEBHOOK_EVENTS = {
    "evt_1P5EkZIfR5z29g5kRH0e4NVx": '{"id": "evt_1P5EkZIfR5z29g5kRH0e4NVx", "object": "event", "api_version": "2024-04-10", "created": 1713046123, "data": {"object": {"id": "cus_Pv4uq0gT0rDZWN", "object": "customer", "address": null, "balance": 0, "created": 1713046123, "currency": null, "default_source": null, "delinquent": false, "description": null, "discount": null, "email": "aapeli@couchers.org", "invoice_prefix": "1D722509", "invoice_settings": {"custom_fields": null, "default_payment_method": null, "footer": null, "rendering_options": null}, "livemode": false, "metadata": {"user_id": "1"}, "name": null, "next_invoice_sequence": 1, "phone": null, "preferred_locales": [], "shipping": null, "tax_exempt": "none", "test_clock": null}}, "livemode": false, "pending_webhooks": 2, "request": {"id": "req_fmlaiE4CYTgEof", "idempotency_key": "8e902937-af49-4880-b3fa-6ccf88bc38ee"}, "type": "customer.created"}',
    "evt_1P5El5IfR5z29g5kNedLGqCz": '{"id": "evt_1P5El5IfR5z29g5kNedLGqCz", "object": "event", "api_version": "2024-04-10", "created": 1713046154, "data": {"object": {"id": "cs_test_a12ftevGwzCAa236NeLPq6yRAdMt0V2S1gGjFcxfsY4xT4tiREPvbr5lhG", "object": "checkout.session", "after_expiration": null, "allow_promotion_codes": null, "amount_subtotal": 10000, "amount_total": 10000, "automatic_tax": {"enabled": false, "liability": null, "status": null}, "billing_address_collection": null, "cancel_url": "http://localhost:3000/donate?cancelled=true", "client_reference_id": "1", "client_secret": null, "consent": null, "consent_collection": null, "created": 1713046124, "currency": "usd", "currency_conversion": null, "custom_fields": [], "custom_text": {"after_submit": null, "shipping_address": null, "submit": null, "terms_of_service_acceptance": null}, "customer": "cus_Pv4uq0gT0rDZWN", "customer_creation": null, "customer_details": {"address": {"city": null, "country": "US", "line1": null, "line2": null, "postal_code": "10001", "state": null}, "email": "aapeli@couchers.org", "name": "Aapeli Vuorinen", "phone": null, "tax_exempt": "none", "tax_ids": []}, "customer_email": null, "expires_at": 1713132523, "invoice": null, "invoice_creation": {"enabled": false, "invoice_data": {"account_tax_ids": null, "custom_fields": null, "description": null, "footer": null, "issuer": null, "metadata": {}, "rendering_options": null}}, "livemode": false, "locale": null, "metadata": {}, "mode": "payment", "payment_intent": "pi_3P5El3IfR5z29g5k0N5TNa7R", "payment_link": null, "payment_method_collection": "if_required", "payment_method_configuration_details": null, "payment_method_options": {"card": {"request_three_d_secure": "automatic"}}, "payment_method_types": ["card"], "payment_status": "paid", "phone_number_collection": {"enabled": false}, "recovered_from": null, "setup_intent": null, "shipping_address_collection": null, "shipping_cost": null, "shipping_details": null, "shipping_options": [], "status": "complete", "submit_type": "donate", "subscription": null, "success_url": "http://localhost:3000/donate?success=true", "total_details": {"amount_discount": 0, "amount_shipping": 0, "amount_tax": 0}, "ui_mode": "hosted", "url": null}}, "livemode": false, "pending_webhooks": 3, "request": {"id": null, "idempotency_key": null}, "type": "checkout.session.completed"}',
    "evt_1P5EmWIfR5z29g5kdOMc8bxr": '{"id": "evt_1P5EmWIfR5z29g5kdOMc8bxr", "object": "event", "api_version": "2024-04-10", "created": 1713046244, "data": {"object": {"id": "cus_Pv4w8dxBpTVUsQ", "object": "customer", "address": null, "balance": 0, "created": 1713046244, "currency": null, "default_source": null, "delinquent": false, "description": null, "discount": null, "email": "aapeli@couchers.org", "invoice_prefix": "D86E702F", "invoice_settings": {"custom_fields": null, "default_payment_method": null, "footer": null, "rendering_options": null}, "livemode": false, "metadata": {"user_id": "1"}, "name": null, "next_invoice_sequence": 1, "phone": null, "preferred_locales": [], "shipping": null, "tax_exempt": "none", "test_clock": null}}, "livemode": false, "pending_webhooks": 2, "request": {"id": "req_3k3Wk50uSmpv6d", "idempotency_key": "a6fc3ba9-0dfa-4f44-a556-4150e6c54922"}, "type": "customer.created"}',
    "evt_1P5En1IfR5z29g5k89Az23Na": '{"id": "evt_1P5En1IfR5z29g5k89Az23Na", "object": "event", "api_version": "2024-04-10", "created": 1713046274, "data": {"object": {"id": "pm_1P5EmyIfR5z29g5kAIZoJcSv", "object": "payment_method", "billing_details": {"address": {"city": null, "country": "US", "line1": null, "line2": null, "postal_code": "10001", "state": null}, "email": "aapeli@couchers.org", "name": "Aapeli Vuorinen", "phone": null}, "card": {"brand": "visa", "checks": {"address_line1_check": null, "address_postal_code_check": "pass", "cvc_check": "pass"}, "country": "US", "display_brand": "visa", "exp_month": 12, "exp_year": 2050, "fingerprint": "2uVHwVtZ157kRjpi", "funding": "credit", "generated_from": null, "last4": "4242", "networks": {"available": ["visa"], "preferred": null}, "three_d_secure_usage": {"supported": true}, "wallet": null}, "created": 1713046272, "customer": "cus_Pv4w8dxBpTVUsQ", "livemode": false, "metadata": {}, "type": "card"}}, "livemode": false, "pending_webhooks": 2, "request": {"id": "req_x1PqgmCHBOPD0i", "idempotency_key": "44ec8acd-be18-4de0-af2e-715760e96725"}, "type": "payment_method.attached"}',
    "evt_1P5En1IfR5z29g5kh279xFFB": '{"id": "evt_1P5En1IfR5z29g5kh279xFFB", "object": "event", "api_version": "2024-04-10", "created": 1713046273, "data": {"object": {"id": "cus_Pv4w8dxBpTVUsQ", "object": "customer", "address": null, "balance": 0, "created": 1713046244, "currency": "usd", "default_source": null, "delinquent": false, "description": null, "discount": null, "email": "aapeli@couchers.org", "invoice_prefix": "D86E702F", "invoice_settings": {"custom_fields": null, "default_payment_method": null, "footer": null, "rendering_options": null}, "livemode": false, "metadata": {"user_id": "1"}, "name": null, "next_invoice_sequence": 2, "phone": null, "preferred_locales": [], "shipping": null, "tax_exempt": "none", "test_clock": null}, "previous_attributes": {"currency": null}}, "livemode": false, "pending_webhooks": 2, "request": {"id": "req_x1PqgmCHBOPD0i", "idempotency_key": "44ec8acd-be18-4de0-af2e-715760e96725"}, "type": "customer.updated"}',
    "evt_1P5En2IfR5z29g5kGrG7cxm7": '{"id": "evt_1P5En2IfR5z29g5kGrG7cxm7", "object": "event", "api_version": "2024-04-10", "created": 1713046273, "data": {"object": {"id": "in_1P5EmzIfR5z29g5kNwA5fIXq", "object": "invoice", "account_country": "US", "account_name": "Couchers, Inc.", "account_tax_ids": null, "amount_due": 2500, "amount_paid": 0, "amount_remaining": 2500, "amount_shipping": 0, "application": null, "application_fee_amount": null, "attempt_count": 0, "attempted": false, "auto_advance": false, "automatic_tax": {"enabled": false, "liability": null, "status": null}, "billing_reason": "subscription_create", "charge": null, "collection_method": "charge_automatically", "created": 1713046273, "currency": "usd", "custom_fields": null, "customer": "cus_Pv4w8dxBpTVUsQ", "customer_address": null, "customer_email": "aapeli@couchers.org", "customer_name": null, "customer_phone": null, "customer_shipping": null, "customer_tax_exempt": "none", "customer_tax_ids": [], "default_payment_method": null, "default_source": null, "default_tax_rates": [], "description": null, "discount": null, "discounts": [], "due_date": null, "effective_at": 1713046273, "ending_balance": 0, "footer": null, "from_invoice": null, "hosted_invoice_url": "https://invoice.stripe.com/i/acct_1KEzByIfR5z29g5k/test_YWNjdF8xS0V6QnlJZlI1ejI5ZzVrLF9QdjR3dzFNVDRGcHo4ZTI1Z05tMXA5WldlMld2VGE2LDEwMzU4NzA3Ng0200xNecenik?s=ap", "invoice_pdf": "https://pay.stripe.com/invoice/acct_1KEzByIfR5z29g5k/test_YWNjdF8xS0V6QnlJZlI1ejI5ZzVrLF9QdjR3dzFNVDRGcHo4ZTI1Z05tMXA5WldlMld2VGE2LDEwMzU4NzA3Ng0200xNecenik/pdf?s=ap", "issuer": {"type": "self"}, "last_finalization_error": null, "latest_revision": null, "lines": {"object": "list", "data": [{"id": "il_1P5EmzIfR5z29g5khRFJxpUq", "object": "line_item", "amount": 2500, "amount_excluding_tax": 2500, "currency": "usd", "description": "25 \u00d7 Couchers financial supporter (Tier 2 at $1.00 / month)", "discount_amounts": [], "discountable": true, "discounts": [], "invoice": "in_1P5EmzIfR5z29g5kNwA5fIXq", "livemode": false, "metadata": {}, "period": {"end": 1715638273, "start": 1713046273}, "plan": {"id": "price_1KIbmbIfR5z29g5kFWPEUnC6", "object": "plan", "active": true, "aggregate_usage": null, "amount": null, "amount_decimal": null, "billing_scheme": "tiered", "created": 1642351245, "currency": "usd", "interval": "month", "interval_count": 1, "livemode": false, "metadata": {}, "nickname": null, "product": "prod_KyYuo4dO67NKtG", "tiers_mode": "volume", "transform_usage": null, "trial_period_days": null, "usage_type": "licensed"}, "price": {"id": "price_1KIbmbIfR5z29g5kFWPEUnC6", "object": "price", "active": true, "billing_scheme": "tiered", "created": 1642351245, "currency": "usd", "custom_unit_amount": null, "livemode": false, "lookup_key": null, "metadata": {}, "nickname": null, "product": "prod_KyYuo4dO67NKtG", "recurring": {"aggregate_usage": null, "interval": "month", "interval_count": 1, "trial_period_days": null, "usage_type": "licensed"}, "tax_behavior": "unspecified", "tiers_mode": "volume", "transform_quantity": null, "type": "recurring", "unit_amount": null, "unit_amount_decimal": null}, "proration": false, "proration_details": {"credited_items": null}, "quantity": 25, "subscription": "sub_1P5EmzIfR5z29g5k2nmkX0l3", "subscription_item": "si_Pv4w0QuX2JUBXm", "tax_amounts": [], "tax_rates": [], "type": "subscription", "unit_amount_excluding_tax": "100"}], "has_more": false, "total_count": 1, "url": "/v1/invoices/in_1P5EmzIfR5z29g5kNwA5fIXq/lines"}, "livemode": false, "metadata": {}, "next_payment_attempt": null, "number": "D86E702F-0001", "on_behalf_of": null, "paid": false, "paid_out_of_band": false, "payment_intent": "pi_3P5EmzIfR5z29g5k0uVvI3kX", "payment_settings": {"default_mandate": null, "payment_method_options": {"acss_debit": null, "bancontact": null, "card": {"request_three_d_secure": "automatic"}, "customer_balance": null, "konbini": null, "sepa_debit": null, "us_bank_account": null}, "payment_method_types": null}, "period_end": 1713046273, "period_start": 1713046273, "post_payment_credit_notes_amount": 0, "pre_payment_credit_notes_amount": 0, "quote": null, "receipt_number": null, "rendering": null, "shipping_cost": null, "shipping_details": null, "starting_balance": 0, "statement_descriptor": null, "status": "open", "status_transitions": {"finalized_at": 1713046273, "marked_uncollectible_at": null, "paid_at": null, "voided_at": null}, "subscription": "sub_1P5EmzIfR5z29g5k2nmkX0l3", "subscription_details": {"metadata": {}}, "subtotal": 2500, "subtotal_excluding_tax": 2500, "tax": null, "test_clock": null, "total": 2500, "total_discount_amounts": [], "total_excluding_tax": 2500, "total_tax_amounts": [], "transfer_data": null, "webhooks_delivered_at": null}}, "livemode": false, "pending_webhooks": 2, "request": {"id": "req_x1PqgmCHBOPD0i", "idempotency_key": "44ec8acd-be18-4de0-af2e-715760e96725"},"type": "invoice.finalized"}',
    "evt_1P5En2IfR5z29g5khvLimtc3": '{"id": "evt_1P5En2IfR5z29g5khvLimtc3", "object": "event", "api_version": "2024-04-10", "created": 1713046273, "data": {"object": {"id": "sub_1P5EmzIfR5z29g5k2nmkX0l3", "object": "subscription", "application": null, "application_fee_percent": null, "automatic_tax": {"enabled": false, "liability": null}, "billing_cycle_anchor": 1713046273, "billing_cycle_anchor_config": null, "billing_thresholds": null, "cancel_at": null, "cancel_at_period_end": false, "canceled_at": null, "cancellation_details": {"comment": null, "feedback": null, "reason": null}, "collection_method": "charge_automatically", "created": 1713046273, "currency": "usd", "current_period_end": 1715638273, "current_period_start": 1713046273, "customer": "cus_Pv4w8dxBpTVUsQ", "days_until_due": null, "default_payment_method": null, "default_source": null, "default_tax_rates": [], "description": null, "discount": null, "discounts": [], "ended_at": null, "invoice_settings": {"account_tax_ids": null, "issuer": {"type": "self"}}, "items": {"object": "list", "data": [{"id": "si_Pv4w0QuX2JUBXm", "object": "subscription_item", "billing_thresholds": null, "created": 1713046273, "discounts": [], "metadata": {}, "plan": {"id": "price_1KIbmbIfR5z29g5kFWPEUnC6", "object": "plan", "active": true, "aggregate_usage": null, "amount": null, "amount_decimal": null, "billing_scheme": "tiered", "created": 1642351245, "currency": "usd", "interval": "month", "interval_count": 1, "livemode": false, "metadata": {}, "nickname": null, "product": "prod_KyYuo4dO67NKtG", "tiers_mode": "volume", "transform_usage": null, "trial_period_days": null, "usage_type": "licensed"}, "price": {"id": "price_1KIbmbIfR5z29g5kFWPEUnC6", "object": "price", "active": true, "billing_scheme": "tiered", "created": 1642351245, "currency": "usd", "custom_unit_amount": null, "livemode": false, "lookup_key": null, "metadata": {}, "nickname": null, "product": "prod_KyYuo4dO67NKtG", "recurring": {"aggregate_usage": null, "interval": "month", "interval_count": 1, "trial_period_days": null, "usage_type": "licensed"}, "tax_behavior": "unspecified", "tiers_mode": "volume", "transform_quantity": null, "type": "recurring", "unit_amount": null, "unit_amount_decimal": null}, "quantity": 25, "subscription": "sub_1P5EmzIfR5z29g5k2nmkX0l3", "tax_rates": []}], "has_more": false, "total_count": 1, "url": "/v1/subscription_items?subscription=sub_1P5EmzIfR5z29g5k2nmkX0l3"}, "latest_invoice": "in_1P5EmzIfR5z29g5kNwA5fIXq", "livemode": false, "metadata": {}, "next_pending_invoice_item_invoice": null, "on_behalf_of": null, "pause_collection": null, "payment_settings": {"payment_method_options": {"acss_debit": null, "bancontact": null, "card": {"network": null, "request_three_d_secure": "automatic"}, "customer_balance": null, "konbini": null, "sepa_debit": null, "us_bank_account": null}, "payment_method_types": null, "save_default_payment_method": "off"}, "pending_invoice_item_interval": null, "pending_setup_intent": null, "pending_update": null, "plan": {"id": "price_1KIbmbIfR5z29g5kFWPEUnC6", "object": "plan", "active": true, "aggregate_usage": null, "amount": null, "amount_decimal": null, "billing_scheme": "tiered", "created": 1642351245, "currency": "usd", "interval": "month", "interval_count": 1, "livemode": false, "metadata": {}, "nickname": null, "product": "prod_KyYuo4dO67NKtG", "tiers_mode": "volume", "transform_usage": null, "trial_period_days": null, "usage_type": "licensed"}, "quantity": 25, "schedule": null, "start_date": 1713046273, "status": "incomplete", "test_clock": null, "transfer_data": null, "trial_end": null, "trial_settings": {"end_behavior": {"missing_payment_method": "create_invoice"}}, "trial_start": null}}, "livemode": false, "pending_webhooks": 2, "request": {"id": "req_x1PqgmCHBOPD0i", "idempotency_key": "44ec8acd-be18-4de0-af2e-715760e96725"}, "type": "customer.subscription.created"}',
    "evt_1P5En2IfR5z29g5kQ3f7d9C6": '{"id": "evt_1P5En2IfR5z29g5kQ3f7d9C6", "object": "event", "api_version": "2024-04-10", "created": 1713046275, "data": {"object": {"id": "sub_1P5EmzIfR5z29g5k2nmkX0l3", "object": "subscription", "application": null, "application_fee_percent": null, "automatic_tax": {"enabled": false, "liability": null}, "billing_cycle_anchor": 1713046273, "billing_cycle_anchor_config": null, "billing_thresholds": null, "cancel_at": null, "cancel_at_period_end": false, "canceled_at": null, "cancellation_details": {"comment": null, "feedback": null, "reason": null}, "collection_method": "charge_automatically", "created": 1713046273, "currency": "usd", "current_period_end": 1715638273, "current_period_start": 1713046273, "customer": "cus_Pv4w8dxBpTVUsQ", "days_until_due": null, "default_payment_method": "pm_1P5EmyIfR5z29g5kAIZoJcSv", "default_source": null, "default_tax_rates": [], "description": null, "discount": null, "discounts": [], "ended_at": null, "invoice_settings": {"account_tax_ids": null, "issuer": {"type": "self"}}, "items": {"object": "list", "data": [{"id": "si_Pv4w0QuX2JUBXm", "object": "subscription_item", "billing_thresholds": null, "created": 1713046273, "discounts": [], "metadata": {}, "plan": {"id": "price_1KIbmbIfR5z29g5kFWPEUnC6", "object": "plan", "active": true, "aggregate_usage": null, "amount": null, "amount_decimal": null, "billing_scheme": "tiered", "created": 1642351245, "currency": "usd", "interval": "month", "interval_count": 1, "livemode": false, "metadata": {}, "nickname": null, "product": "prod_KyYuo4dO67NKtG", "tiers_mode": "volume", "transform_usage": null, "trial_period_days": null, "usage_type": "licensed"}, "price": {"id": "price_1KIbmbIfR5z29g5kFWPEUnC6", "object": "price", "active": true, "billing_scheme": "tiered", "created": 1642351245, "currency": "usd", "custom_unit_amount": null, "livemode": false, "lookup_key": null, "metadata": {}, "nickname": null, "product": "prod_KyYuo4dO67NKtG", "recurring": {"aggregate_usage": null, "interval": "month", "interval_count": 1, "trial_period_days": null, "usage_type": "licensed"}, "tax_behavior": "unspecified", "tiers_mode": "volume", "transform_quantity": null, "type": "recurring", "unit_amount": null, "unit_amount_decimal": null}, "quantity": 25, "subscription": "sub_1P5EmzIfR5z29g5k2nmkX0l3", "tax_rates": []}], "has_more": false, "total_count": 1, "url": "/v1/subscription_items?subscription=sub_1P5EmzIfR5z29g5k2nmkX0l3"}, "latest_invoice": "in_1P5EmzIfR5z29g5kNwA5fIXq", "livemode": false, "metadata": {}, "next_pending_invoice_item_invoice": null, "on_behalf_of": null, "pause_collection": null, "payment_settings": {"payment_method_options": {"acss_debit": null, "bancontact": null, "card": {"network": null, "request_three_d_secure": "automatic"}, "customer_balance": null, "konbini": null, "sepa_debit": null, "us_bank_account": null}, "payment_method_types": null, "save_default_payment_method": "off"}, "pending_invoice_item_interval": null, "pending_setup_intent": null, "pending_update": null, "plan": {"id": "price_1KIbmbIfR5z29g5kFWPEUnC6", "object": "plan", "active": true, "aggregate_usage": null, "amount": null, "amount_decimal": null, "billing_scheme": "tiered", "created": 1642351245, "currency": "usd", "interval": "month", "interval_count": 1, "livemode": false, "metadata": {}, "nickname": null, "product": "prod_KyYuo4dO67NKtG", "tiers_mode": "volume", "transform_usage": null, "trial_period_days": null, "usage_type": "licensed"}, "quantity": 25, "schedule": null, "start_date": 1713046273, "status": "active", "test_clock": null, "transfer_data": null, "trial_end": null, "trial_settings": {"end_behavior": {"missing_payment_method": "create_invoice"}}, "trial_start": null}, "previous_attributes": {"default_payment_method": null, "status": "incomplete"}}, "livemode": false, "pending_webhooks": 2, "request": {"id": "req_x1PqgmCHBOPD0i", "idempotency_key": "44ec8acd-be18-4de0-af2e-715760e96725"}, "type": "customer.subscription.updated"}',
    "evt_1P5En2IfR5z29g5kQZBnH8bR": '{"id": "evt_1P5En2IfR5z29g5kQZBnH8bR", "object": "event", "api_version": "2024-04-10", "created": 1713046273, "data": {"object": {"id": "in_1P5EmzIfR5z29g5kNwA5fIXq", "object": "invoice", "account_country": "US", "account_name": "Couchers, Inc.", "account_tax_ids": null, "amount_due": 2500, "amount_paid": 0, "amount_remaining": 2500, "amount_shipping": 0, "application": null, "application_fee_amount": null, "attempt_count": 0, "attempted": false, "auto_advance": false, "automatic_tax": {"enabled": false, "liability": null, "status": null}, "billing_reason": "subscription_create", "charge": null, "collection_method": "charge_automatically", "created": 1713046273, "currency": "usd", "custom_fields": null, "customer": "cus_Pv4w8dxBpTVUsQ", "customer_address": null, "customer_email": "aapeli@couchers.org", "customer_name": null, "customer_phone": null, "customer_shipping": null, "customer_tax_exempt": "none", "customer_tax_ids": [], "default_payment_method": null, "default_source": null, "default_tax_rates": [], "description": null, "discount": null, "discounts": [], "due_date": null, "effective_at": 1713046273, "ending_balance": 0, "footer": null, "from_invoice": null, "hosted_invoice_url": "https://invoice.stripe.com/i/acct_1KEzByIfR5z29g5k/test_YWNjdF8xS0V6QnlJZlI1ejI5ZzVrLF9QdjR3dzFNVDRGcHo4ZTI1Z05tMXA5WldlMld2VGE2LDEwMzU4NzA3Ng0200xNecenik?s=ap", "invoice_pdf": "https://pay.stripe.com/invoice/acct_1KEzByIfR5z29g5k/test_YWNjdF8xS0V6QnlJZlI1ejI5ZzVrLF9QdjR3dzFNVDRGcHo4ZTI1Z05tMXA5WldlMld2VGE2LDEwMzU4NzA3Ng0200xNecenik/pdf?s=ap", "issuer": {"type": "self"}, "last_finalization_error": null, "latest_revision": null, "lines": {"object": "list", "data": [{"id": "il_1P5EmzIfR5z29g5khRFJxpUq", "object": "line_item", "amount": 2500, "amount_excluding_tax": 2500, "currency": "usd", "description": "25 \u00d7 Couchers financial supporter (Tier 2 at $1.00 / month)", "discount_amounts": [], "discountable": true, "discounts": [], "invoice": "in_1P5EmzIfR5z29g5kNwA5fIXq", "livemode": false, "metadata": {}, "period": {"end": 1715638273, "start": 1713046273}, "plan": {"id": "price_1KIbmbIfR5z29g5kFWPEUnC6", "object": "plan", "active": true, "aggregate_usage": null, "amount": null, "amount_decimal": null, "billing_scheme": "tiered", "created": 1642351245, "currency": "usd", "interval": "month", "interval_count": 1, "livemode": false, "metadata": {}, "nickname": null, "product": "prod_KyYuo4dO67NKtG", "tiers_mode": "volume", "transform_usage": null, "trial_period_days": null, "usage_type": "licensed"}, "price": {"id": "price_1KIbmbIfR5z29g5kFWPEUnC6", "object": "price", "active": true, "billing_scheme": "tiered", "created": 1642351245, "currency": "usd", "custom_unit_amount": null, "livemode": false, "lookup_key": null, "metadata": {}, "nickname": null, "product": "prod_KyYuo4dO67NKtG", "recurring": {"aggregate_usage": null, "interval": "month", "interval_count": 1, "trial_period_days": null, "usage_type": "licensed"}, "tax_behavior": "unspecified", "tiers_mode": "volume", "transform_quantity": null, "type": "recurring", "unit_amount": null, "unit_amount_decimal": null}, "proration": false, "proration_details": {"credited_items": null}, "quantity": 25, "subscription": "sub_1P5EmzIfR5z29g5k2nmkX0l3", "subscription_item": "si_Pv4w0QuX2JUBXm", "tax_amounts": [], "tax_rates": [], "type": "subscription", "unit_amount_excluding_tax": "100"}], "has_more": false, "total_count": 1, "url": "/v1/invoices/in_1P5EmzIfR5z29g5kNwA5fIXq/lines"}, "livemode": false, "metadata": {}, "next_payment_attempt": null, "number": "D86E702F-0001", "on_behalf_of": null, "paid": false, "paid_out_of_band": false, "payment_intent": "pi_3P5EmzIfR5z29g5k0uVvI3kX", "payment_settings": {"default_mandate": null, "payment_method_options": {"acss_debit": null, "bancontact": null, "card": {"request_three_d_secure": "automatic"}, "customer_balance": null, "konbini": null, "sepa_debit": null, "us_bank_account": null}, "payment_method_types": null}, "period_end": 1713046273, "period_start": 1713046273, "post_payment_credit_notes_amount": 0, "pre_payment_credit_notes_amount": 0, "quote": null, "receipt_number": null, "rendering": null, "shipping_cost": null, "shipping_details": null, "starting_balance": 0, "statement_descriptor": null, "status": "open", "status_transitions": {"finalized_at": 1713046273, "marked_uncollectible_at": null, "paid_at": null, "voided_at": null}, "subscription": "sub_1P5EmzIfR5z29g5k2nmkX0l3", "subscription_details": {"metadata": {}}, "subtotal": 2500, "subtotal_excluding_tax": 2500, "tax": null, "test_clock": null, "total": 2500, "total_discount_amounts": [], "total_excluding_tax": 2500, "total_tax_amounts": [], "transfer_data": null, "webhooks_delivered_at": null}}, "livemode": false, "pending_webhooks": 2, "request": {"id": "req_x1PqgmCHBOPD0i", "idempotency_key": "44ec8acd-be18-4de0-af2e-715760e96725"}, "type": "invoice.created"}',
    "evt_1P5En3IfR5z29g5k3ElqoMso": '{"id": "evt_1P5En3IfR5z29g5k3ElqoMso", "object": "event", "api_version": "2024-04-10", "created": 1713046275, "data": {"object": {"id": "in_1P5EmzIfR5z29g5kNwA5fIXq", "object": "invoice", "account_country": "US", "account_name": "Couchers, Inc.", "account_tax_ids": null, "amount_due": 2500, "amount_paid": 2500, "amount_remaining": 0, "amount_shipping": 0, "application": null, "application_fee_amount": null, "attempt_count": 1, "attempted": true, "auto_advance": false, "automatic_tax": {"enabled": false, "liability": null, "status": null}, "billing_reason": "subscription_create", "charge": "ch_3P5EmzIfR5z29g5k05Mw6ZV2", "collection_method": "charge_automatically", "created": 1713046273, "currency": "usd", "custom_fields": null, "customer": "cus_Pv4w8dxBpTVUsQ", "customer_address": null, "customer_email": "aapeli@couchers.org", "customer_name": null, "customer_phone": null, "customer_shipping": null, "customer_tax_exempt": "none", "customer_tax_ids": [], "default_payment_method": null, "default_source": null, "default_tax_rates": [], "description": null, "discount": null, "discounts": [], "due_date": null, "effective_at": 1713046273, "ending_balance": 0, "footer": null, "from_invoice": null, "hosted_invoice_url": "https://invoice.stripe.com/i/acct_1KEzByIfR5z29g5k/test_YWNjdF8xS0V6QnlJZlI1ejI5ZzVrLF9QdjR3dzFNVDRGcHo4ZTI1Z05tMXA5WldlMld2VGE2LDEwMzU4NzA3Nw0200Xbr3gdqx?s=ap", "invoice_pdf": "https://pay.stripe.com/invoice/acct_1KEzByIfR5z29g5k/test_YWNjdF8xS0V6QnlJZlI1ejI5ZzVrLF9QdjR3dzFNVDRGcHo4ZTI1Z05tMXA5WldlMld2VGE2LDEwMzU4NzA3Nw0200Xbr3gdqx/pdf?s=ap", "issuer": {"type": "self"}, "last_finalization_error": null, "latest_revision": null, "lines": {"object": "list", "data": [{"id": "il_1P5EmzIfR5z29g5khRFJxpUq", "object": "line_item", "amount": 2500, "amount_excluding_tax": 2500, "currency": "usd", "description": "25 \u00d7 Couchers financial supporter (Tier 2 at $1.00 / month)", "discount_amounts": [], "discountable": true, "discounts": [], "invoice": "in_1P5EmzIfR5z29g5kNwA5fIXq", "livemode": false, "metadata": {}, "period": {"end": 1715638273, "start": 1713046273}, "plan": {"id": "price_1KIbmbIfR5z29g5kFWPEUnC6", "object": "plan", "active": true, "aggregate_usage": null, "amount": null, "amount_decimal": null, "billing_scheme": "tiered", "created": 1642351245, "currency": "usd", "interval": "month", "interval_count": 1, "livemode": false, "metadata": {}, "nickname": null, "product": "prod_KyYuo4dO67NKtG", "tiers_mode": "volume", "transform_usage": null, "trial_period_days": null, "usage_type": "licensed"}, "price": {"id": "price_1KIbmbIfR5z29g5kFWPEUnC6", "object": "price", "active": true, "billing_scheme": "tiered", "created": 1642351245, "currency": "usd", "custom_unit_amount": null, "livemode": false, "lookup_key": null, "metadata": {}, "nickname": null, "product": "prod_KyYuo4dO67NKtG", "recurring": {"aggregate_usage": null, "interval": "month", "interval_count": 1, "trial_period_days": null, "usage_type": "licensed"}, "tax_behavior": "unspecified", "tiers_mode": "volume", "transform_quantity": null, "type": "recurring", "unit_amount": null, "unit_amount_decimal": null}, "proration": false, "proration_details": {"credited_items": null}, "quantity": 25, "subscription": "sub_1P5EmzIfR5z29g5k2nmkX0l3", "subscription_item": "si_Pv4w0QuX2JUBXm", "tax_amounts": [], "tax_rates": [], "type": "subscription", "unit_amount_excluding_tax": "100"}], "has_more": false, "total_count": 1, "url": "/v1/invoices/in_1P5EmzIfR5z29g5kNwA5fIXq/lines"}, "livemode": false, "metadata": {}, "next_payment_attempt": null, "number": "D86E702F-0001", "on_behalf_of": null, "paid": true, "paid_out_of_band": false, "payment_intent": "pi_3P5EmzIfR5z29g5k0uVvI3kX", "payment_settings": {"default_mandate": null, "payment_method_options": {"acss_debit": null, "bancontact": null, "card": {"request_three_d_secure": "automatic"}, "customer_balance": null, "konbini": null, "sepa_debit": null, "us_bank_account": null}, "payment_method_types": null}, "period_end": 1713046273, "period_start": 1713046273, "post_payment_credit_notes_amount": 0, "pre_payment_credit_notes_amount": 0, "quote": null, "receipt_number": null, "rendering": null, "shipping_cost": null, "shipping_details": null, "starting_balance": 0, "statement_descriptor": null, "status": "paid", "status_transitions": {"finalized_at": 1713046273, "marked_uncollectible_at": null, "paid_at": 1713046275, "voided_at": null}, "subscription": "sub_1P5EmzIfR5z29g5k2nmkX0l3", "subscription_details": {"metadata": {}}, "subtotal": 2500, "subtotal_excluding_tax": 2500, "tax": null, "test_clock": null, "total": 2500, "total_discount_amounts": [], "total_excluding_tax": 2500, "total_tax_amounts": [], "transfer_data": null, "webhooks_delivered_at": null}}, "livemode": false, "pending_webhooks": 2, "request": {"id": "req_x1PqgmCHBOPD0i", "idempotency_key": "44ec8acd-be18-4de0-af2e-715760e96725"}, "type": "invoice.payment_succeeded"}',
    "evt_1P5En3IfR5z29g5kOoaABPf4": '{"id": "evt_1P5En3IfR5z29g5kOoaABPf4", "object": "event", "api_version": "2024-04-10", "created": 1713046277, "data": {"object": {"id": "cs_test_a1JoMu1FbksL058ob6T6AC1byYR2DCXVRwi0ybLSZKwINYe868OQr25qaC", "object": "checkout.session", "after_expiration": null, "allow_promotion_codes": null, "amount_subtotal": 2500, "amount_total": 2500, "automatic_tax": {"enabled": false, "liability": null, "status": null}, "billing_address_collection": null, "cancel_url": "http://localhost:3000/donate?cancelled=true", "client_reference_id": "1", "client_secret": null, "consent": null, "consent_collection": null, "created": 1713046244, "currency": "usd", "currency_conversion": null, "custom_fields": [], "custom_text": {"after_submit": null, "shipping_address": null, "submit": null, "terms_of_service_acceptance": null}, "customer": "cus_Pv4w8dxBpTVUsQ", "customer_creation": null, "customer_details": {"address": {"city": null, "country": "US", "line1": null, "line2": null, "postal_code": "10001", "state": null}, "email": "aapeli@couchers.org", "name": "Aapeli Vuorinen", "phone": null, "tax_exempt": "none", "tax_ids": []}, "customer_email": null, "expires_at": 1713132644, "invoice": "in_1P5EmzIfR5z29g5kNwA5fIXq", "invoice_creation": null, "livemode": false, "locale": null, "metadata": {}, "mode": "subscription", "payment_intent": null, "payment_link": null, "payment_method_collection": "always", "payment_method_configuration_details": null, "payment_method_options": {"card": {"request_three_d_secure": "automatic"}}, "payment_method_types": ["card"], "payment_status": "paid", "phone_number_collection": {"enabled": false}, "recovered_from": null, "setup_intent": null, "shipping_address_collection": null, "shipping_cost": null, "shipping_details": null, "shipping_options": [], "status": "complete", "submit_type": null, "subscription": "sub_1P5EmzIfR5z29g5k2nmkX0l3", "success_url": "http://localhost:3000/donate?success=true", "total_details": {"amount_discount": 0, "amount_shipping": 0, "amount_tax": 0}, "ui_mode": "hosted", "url": null}}, "livemode": false, "pending_webhooks": 3, "request": {"id": null, "idempotency_key": null}, "type": "checkout.session.completed"}',
    "evt_1P5En3IfR5z29g5kRKYnPpgc": '{"id": "evt_1P5En3IfR5z29g5kRKYnPpgc", "object": "event", "api_version": "2024-04-10", "created": 1713046275, "data": {"object": {"id": "in_1P5EmzIfR5z29g5kNwA5fIXq", "object": "invoice", "account_country": "US", "account_name": "Couchers, Inc.", "account_tax_ids": null, "amount_due": 2500, "amount_paid": 2500, "amount_remaining": 0, "amount_shipping": 0, "application": null, "application_fee_amount": null, "attempt_count": 1, "attempted": true, "auto_advance": false, "automatic_tax": {"enabled": false, "liability": null, "status": null}, "billing_reason": "subscription_create", "charge": "ch_3P5EmzIfR5z29g5k05Mw6ZV2", "collection_method": "charge_automatically", "created": 1713046273, "currency": "usd", "custom_fields": null, "customer": "cus_Pv4w8dxBpTVUsQ", "customer_address": null, "customer_email": "aapeli@couchers.org", "customer_name": null, "customer_phone": null, "customer_shipping": null, "customer_tax_exempt": "none", "customer_tax_ids": [], "default_payment_method": null, "default_source": null, "default_tax_rates": [], "description": null, "discount": null, "discounts": [], "due_date": null, "effective_at": 1713046273, "ending_balance": 0, "footer": null, "from_invoice": null, "hosted_invoice_url": "https://invoice.stripe.com/i/acct_1KEzByIfR5z29g5k/test_YWNjdF8xS0V6QnlJZlI1ejI5ZzVrLF9QdjR3dzFNVDRGcHo4ZTI1Z05tMXA5WldlMld2VGE2LDEwMzU4NzA3Ng0200xNecenik?s=ap", "invoice_pdf": "https://pay.stripe.com/invoice/acct_1KEzByIfR5z29g5k/test_YWNjdF8xS0V6QnlJZlI1ejI5ZzVrLF9QdjR3dzFNVDRGcHo4ZTI1Z05tMXA5WldlMld2VGE2LDEwMzU4NzA3Ng0200xNecenik/pdf?s=ap", "issuer": {"type": "self"}, "last_finalization_error": null, "latest_revision": null, "lines": {"object": "list", "data": [{"id": "il_1P5EmzIfR5z29g5khRFJxpUq", "object": "line_item", "amount": 2500, "amount_excluding_tax": 2500, "currency": "usd", "description": "25 \u00d7 Couchers financial supporter (Tier 2 at $1.00 / month)", "discount_amounts": [], "discountable": true, "discounts": [], "invoice": "in_1P5EmzIfR5z29g5kNwA5fIXq", "livemode": false, "metadata": {}, "period": {"end": 1715638273, "start": 1713046273}, "plan": {"id": "price_1KIbmbIfR5z29g5kFWPEUnC6", "object": "plan", "active": true, "aggregate_usage": null, "amount": null, "amount_decimal": null, "billing_scheme": "tiered", "created": 1642351245, "currency": "usd", "interval": "month", "interval_count": 1, "livemode": false, "metadata": {}, "nickname": null, "product": "prod_KyYuo4dO67NKtG", "tiers_mode": "volume", "transform_usage": null, "trial_period_days": null, "usage_type": "licensed"}, "price": {"id": "price_1KIbmbIfR5z29g5kFWPEUnC6", "object": "price", "active": true, "billing_scheme": "tiered", "created": 1642351245, "currency": "usd", "custom_unit_amount": null, "livemode": false, "lookup_key": null, "metadata": {}, "nickname": null, "product": "prod_KyYuo4dO67NKtG", "recurring": {"aggregate_usage": null, "interval": "month", "interval_count": 1, "trial_period_days": null, "usage_type": "licensed"}, "tax_behavior": "unspecified", "tiers_mode": "volume", "transform_quantity": null, "type": "recurring", "unit_amount": null, "unit_amount_decimal": null}, "proration": false, "proration_details": {"credited_items": null}, "quantity": 25, "subscription": "sub_1P5EmzIfR5z29g5k2nmkX0l3", "subscription_item": "si_Pv4w0QuX2JUBXm", "tax_amounts": [], "tax_rates": [], "type": "subscription", "unit_amount_excluding_tax": "100"}], "has_more": false, "total_count": 1, "url": "/v1/invoices/in_1P5EmzIfR5z29g5kNwA5fIXq/lines"}, "livemode": false, "metadata": {}, "next_payment_attempt": null, "number": "D86E702F-0001", "on_behalf_of": null, "paid": true, "paid_out_of_band": false, "payment_intent": "pi_3P5EmzIfR5z29g5k0uVvI3kX", "payment_settings": {"default_mandate": null, "payment_method_options": {"acss_debit": null, "bancontact": null, "card": {"request_three_d_secure": "automatic"}, "customer_balance": null, "konbini": null, "sepa_debit": null, "us_bank_account": null}, "payment_method_types": null}, "period_end": 1713046273, "period_start": 1713046273, "post_payment_credit_notes_amount": 0, "pre_payment_credit_notes_amount": 0, "quote": null, "receipt_number": null, "rendering": null, "shipping_cost": null, "shipping_details": null, "starting_balance": 0, "statement_descriptor": null, "status": "paid", "status_transitions": {"finalized_at": 1713046273, "marked_uncollectible_at": null, "paid_at": 1713046275, "voided_at": null}, "subscription": "sub_1P5EmzIfR5z29g5k2nmkX0l3", "subscription_details": {"metadata": {}}, "subtotal": 2500, "subtotal_excluding_tax": 2500, "tax": null, "test_clock": null, "total": 2500, "total_discount_amounts": [], "total_excluding_tax": 2500, "total_tax_amounts": [], "transfer_data": null, "webhooks_delivered_at": null}, "previous_attributes": {"amount_paid": 0, "amount_remaining": 2500, "attempt_count": 0, "attempted": false, "charge": null, "paid": false, "status": "open", "status_transitions": {"paid_at": null}}}, "livemode": false, "pending_webhooks": 2, "request": {"id": "req_x1PqgmCHBOPD0i", "idempotency_key": "44ec8acd-be18-4de0-af2e-715760e96725"}, "type": "invoice.updated"}',
    "evt_1P5En3IfR5z29g5kXDrXUkQa": '{"id": "evt_1P5En3IfR5z29g5kXDrXUkQa", "object": "event", "api_version": "2024-04-10", "created": 1713046275, "data": {"object": {"id": "in_1P5EmzIfR5z29g5kNwA5fIXq", "object": "invoice", "account_country": "US", "account_name": "Couchers, Inc.", "account_tax_ids": null, "amount_due": 2500, "amount_paid": 2500, "amount_remaining": 0, "amount_shipping": 0, "application": null, "application_fee_amount": null, "attempt_count": 1, "attempted": true, "auto_advance": false, "automatic_tax": {"enabled": false, "liability": null, "status": null}, "billing_reason": "subscription_create", "charge": "ch_3P5EmzIfR5z29g5k05Mw6ZV2", "collection_method": "charge_automatically", "created": 1713046273, "currency": "usd", "custom_fields": null, "customer": "cus_Pv4w8dxBpTVUsQ", "customer_address": null, "customer_email": "aapeli@couchers.org", "customer_name": null, "customer_phone": null, "customer_shipping": null, "customer_tax_exempt": "none", "customer_tax_ids": [], "default_payment_method": null, "default_source": null, "default_tax_rates": [], "description": null, "discount": null, "discounts": [], "due_date": null, "effective_at": 1713046273, "ending_balance": 0, "footer": null, "from_invoice": null, "hosted_invoice_url": "https://invoice.stripe.com/i/acct_1KEzByIfR5z29g5k/test_YWNjdF8xS0V6QnlJZlI1ejI5ZzVrLF9QdjR3dzFNVDRGcHo4ZTI1Z05tMXA5WldlMld2VGE2LDEwMzU4NzA3Nw0200Xbr3gdqx?s=ap", "invoice_pdf": "https://pay.stripe.com/invoice/acct_1KEzByIfR5z29g5k/test_YWNjdF8xS0V6QnlJZlI1ejI5ZzVrLF9QdjR3dzFNVDRGcHo4ZTI1Z05tMXA5WldlMld2VGE2LDEwMzU4NzA3Nw0200Xbr3gdqx/pdf?s=ap", "issuer": {"type": "self"}, "last_finalization_error": null, "latest_revision": null, "lines": {"object": "list", "data": [{"id": "il_1P5EmzIfR5z29g5khRFJxpUq", "object": "line_item", "amount": 2500, "amount_excluding_tax": 2500, "currency": "usd", "description": "25 \u00d7 Couchers financial supporter (Tier 2 at $1.00 / month)", "discount_amounts": [], "discountable": true, "discounts": [], "invoice": "in_1P5EmzIfR5z29g5kNwA5fIXq", "livemode": false, "metadata": {}, "period": {"end": 1715638273, "start": 1713046273}, "plan": {"id": "price_1KIbmbIfR5z29g5kFWPEUnC6", "object": "plan", "active": true, "aggregate_usage": null, "amount": null, "amount_decimal": null, "billing_scheme": "tiered", "created": 1642351245, "currency": "usd", "interval": "month", "interval_count": 1, "livemode": false, "metadata": {}, "nickname": null, "product": "prod_KyYuo4dO67NKtG", "tiers_mode": "volume", "transform_usage": null, "trial_period_days": null, "usage_type": "licensed"}, "price": {"id": "price_1KIbmbIfR5z29g5kFWPEUnC6", "object": "price", "active": true, "billing_scheme": "tiered", "created": 1642351245, "currency": "usd", "custom_unit_amount": null, "livemode": false, "lookup_key": null, "metadata": {}, "nickname": null, "product": "prod_KyYuo4dO67NKtG", "recurring": {"aggregate_usage": null, "interval": "month", "interval_count": 1, "trial_period_days": null, "usage_type": "licensed"}, "tax_behavior": "unspecified", "tiers_mode": "volume", "transform_quantity": null, "type": "recurring", "unit_amount": null, "unit_amount_decimal": null}, "proration": false, "proration_details": {"credited_items": null}, "quantity": 25, "subscription": "sub_1P5EmzIfR5z29g5k2nmkX0l3", "subscription_item": "si_Pv4w0QuX2JUBXm", "tax_amounts": [], "tax_rates": [], "type": "subscription", "unit_amount_excluding_tax": "100"}], "has_more": false, "total_count": 1, "url": "/v1/invoices/in_1P5EmzIfR5z29g5kNwA5fIXq/lines"}, "livemode": false, "metadata": {}, "next_payment_attempt": null, "number": "D86E702F-0001", "on_behalf_of": null, "paid": true, "paid_out_of_band": false, "payment_intent": "pi_3P5EmzIfR5z29g5k0uVvI3kX", "payment_settings": {"default_mandate": null, "payment_method_options": {"acss_debit": null, "bancontact": null, "card": {"request_three_d_secure": "automatic"}, "customer_balance": null, "konbini": null, "sepa_debit": null, "us_bank_account": null}, "payment_method_types": null}, "period_end": 1713046273, "period_start": 1713046273, "post_payment_credit_notes_amount": 0, "pre_payment_credit_notes_amount": 0, "quote": null, "receipt_number": null, "rendering": null, "shipping_cost": null, "shipping_details": null, "starting_balance": 0, "statement_descriptor": null, "status": "paid", "status_transitions": {"finalized_at": 1713046273, "marked_uncollectible_at": null, "paid_at": 1713046275, "voided_at": null}, "subscription": "sub_1P5EmzIfR5z29g5k2nmkX0l3", "subscription_details": {"metadata": {}}, "subtotal": 2500, "subtotal_excluding_tax": 2500, "tax": null, "test_clock": null, "total": 2500, "total_discount_amounts": [], "total_excluding_tax": 2500, "total_tax_amounts": [], "transfer_data": null, "webhooks_delivered_at": null}}, "livemode": false, "pending_webhooks": 2, "request": {"id": "req_x1PqgmCHBOPD0i", "idempotency_key": "44ec8acd-be18-4de0-af2e-715760e96725"}, "type": "invoice.paid"}',
    "evt_3P5El3IfR5z29g5k0mFVJ2V7": '{"id": "evt_3P5El3IfR5z29g5k0mFVJ2V7", "object": "event", "api_version": "2024-04-10", "created": 1713046153, "data": {"object": {"id": "pi_3P5El3IfR5z29g5k0N5TNa7R", "object": "payment_intent", "amount": 10000, "amount_capturable": 0, "amount_details": {"tip": {}}, "amount_received": 0, "application": null, "application_fee_amount": null, "automatic_payment_methods": null, "canceled_at": null, "cancellation_reason": null, "capture_method": "automatic", "client_secret": "pi_3P5El3IfR5z29g5k0N5TNa7R_secret_BIdVdUUKk8zPCuttemp8Jl4uf", "confirmation_method": "automatic", "created": 1713046153, "currency": "usd", "customer": "cus_Pv4uq0gT0rDZWN", "description": null, "invoice": null, "last_payment_error": null, "latest_charge": null, "livemode": false, "metadata": {}, "next_action": null, "on_behalf_of": null, "payment_method": null, "payment_method_configuration_details": null, "payment_method_options": {"card": {"installments": null, "mandate_options": null, "network": null, "request_three_d_secure": "automatic"}}, "payment_method_types": ["card"], "processing": null, "receipt_email": "aapeli@couchers.org", "review": null, "setup_future_usage": null, "shipping": null, "source": null, "statement_descriptor": null, "statement_descriptor_suffix": null, "status": "requires_payment_method", "transfer_data": null, "transfer_group": null}}, "livemode": false, "pending_webhooks": 2, "request": {"id": "req_kVsPqUwBoL4xen", "idempotency_key": "d3051b38-f32b-4118-b456-56897ce6b96d"}, "type": "payment_intent.created"}',
    "evt_3P5El3IfR5z29g5k0TLWlfHq": '{"id": "evt_3P5El3IfR5z29g5k0TLWlfHq", "object": "event", "api_version": "2024-04-10", "created": 1713046154, "data": {"object": {"id": "ch_3P5El3IfR5z29g5k03QfMZRt", "object": "charge", "amount": 10000, "amount_captured": 10000, "amount_refunded": 0, "application": null, "application_fee": null, "application_fee_amount": null, "balance_transaction": "txn_3P5El3IfR5z29g5k0Jmn0th5", "billing_details": {"address": {"city": null, "country": "US", "line1": null, "line2": null, "postal_code": "10001", "state": null}, "email": "aapeli@couchers.org", "name": "Aapeli Vuorinen", "phone": null}, "calculated_statement_descriptor": "COUCHERS.ORG", "captured": true, "created": 1713046154, "currency": "usd", "customer": "cus_Pv4uq0gT0rDZWN", "description": null, "destination": null, "dispute": null, "disputed": false, "failure_balance_transaction": null, "failure_code": null, "failure_message": null, "fraud_details": {}, "invoice": null, "livemode": false, "metadata": {}, "on_behalf_of": null, "order": null, "outcome": {"network_status": "approved_by_network", "reason": null, "risk_level": "normal", "risk_score": 31, "seller_message": "Payment complete.", "type": "authorized"}, "paid": true, "payment_intent": "pi_3P5El3IfR5z29g5k0N5TNa7R", "payment_method": "pm_1P5El3IfR5z29g5k33WlbWVC", "payment_method_details": {"card": {"amount_authorized": 10000, "brand": "visa", "checks": {"address_line1_check": null, "address_postal_code_check": "pass", "cvc_check": "pass"}, "country": "US", "exp_month": 12, "exp_year": 2050, "extended_authorization": {"status": "disabled"}, "fingerprint": "2uVHwVtZ157kRjpi", "funding": "credit", "incremental_authorization": {"status": "unavailable"}, "installments": null, "last4": "4242", "mandate": null, "multicapture": {"status": "unavailable"}, "network": "visa", "network_token": {"used": false}, "overcapture": {"maximum_amount_capturable": 10000, "status": "unavailable"}, "three_d_secure": null, "wallet": null}, "type": "card"}, "radar_options": {}, "receipt_email": "aapeli@couchers.org", "receipt_number": null, "receipt_url": "https://pay.stripe.com/receipts/payment/CAcaFwoVYWNjdF8xS0V6QnlJZlI1ejI5ZzVrKIqF7LAGMgbtNxpJulk6LBaePNy_2Q2RzXJsbk7t1jLwK26AQlG05P-4EPhG7AIIcqsQLgC09iDJ2srs", "refunded": false, "review": null, "shipping": null, "source": null, "source_transfer": null, "statement_descriptor": null, "statement_descriptor_suffix": null, "status": "succeeded", "transfer_data": null, "transfer_group": null}}, "livemode": false, "pending_webhooks": 2, "request": {"id": "req_kVsPqUwBoL4xen", "idempotency_key": "d3051b38-f32b-4118-b456-56897ce6b96d"}, "type": "charge.succeeded"}',
    "evt_3P5El3IfR5z29g5k0tueVWGH": '{"id": "evt_3P5El3IfR5z29g5k0tueVWGH", "object": "event", "api_version": "2024-04-10", "created": 1713046154, "data": {"object": {"id": "pi_3P5El3IfR5z29g5k0N5TNa7R", "object": "payment_intent", "amount": 10000, "amount_capturable": 0, "amount_details": {"tip": {}}, "amount_received": 10000, "application": null, "application_fee_amount": null, "automatic_payment_methods": null, "canceled_at": null, "cancellation_reason": null, "capture_method": "automatic", "client_secret": "pi_3P5El3IfR5z29g5k0N5TNa7R_secret_BIdVdUUKk8zPCuttemp8Jl4uf", "confirmation_method": "automatic", "created": 1713046153, "currency": "usd", "customer": "cus_Pv4uq0gT0rDZWN", "description": null, "invoice": null, "last_payment_error": null, "latest_charge": "ch_3P5El3IfR5z29g5k03QfMZRt", "livemode": false, "metadata": {}, "next_action": null, "on_behalf_of": null, "payment_method": "pm_1P5El3IfR5z29g5k33WlbWVC", "payment_method_configuration_details": null, "payment_method_options": {"card": {"installments": null, "mandate_options": null, "network": null, "request_three_d_secure": "automatic"}}, "payment_method_types": ["card"], "processing": null, "receipt_email": "aapeli@couchers.org", "review": null, "setup_future_usage": null, "shipping": null, "source": null, "statement_descriptor": null, "statement_descriptor_suffix": null, "status": "succeeded", "transfer_data": null, "transfer_group": null}}, "livemode": false, "pending_webhooks": 3, "request": {"id": "req_kVsPqUwBoL4xen", "idempotency_key": "d3051b38-f32b-4118-b456-56897ce6b96d"}, "type": "payment_intent.succeeded"}',
    "evt_3P5EmzIfR5z29g5k0bA1H9Vg": '{"id": "evt_3P5EmzIfR5z29g5k0bA1H9Vg", "object": "event", "api_version": "2024-04-10", "created": 1713046274, "data": {"object": {"id": "ch_3P5EmzIfR5z29g5k05Mw6ZV2", "object": "charge", "amount": 2500, "amount_captured": 2500, "amount_refunded": 0, "application": null, "application_fee": null, "application_fee_amount": null, "balance_transaction": "txn_3P5EmzIfR5z29g5k0U5iEbk1", "billing_details": {"address": {"city": null, "country": "US", "line1": null, "line2": null, "postal_code": "10001", "state": null}, "email": "aapeli@couchers.org", "name": "Aapeli Vuorinen", "phone": null}, "calculated_statement_descriptor": "COUCHERS.ORG", "captured": true, "created": 1713046274, "currency": "usd", "customer": "cus_Pv4w8dxBpTVUsQ", "description": "Subscription creation", "destination": null, "dispute": null, "disputed": false, "failure_balance_transaction": null, "failure_code": null, "failure_message": null, "fraud_details": {}, "invoice": "in_1P5EmzIfR5z29g5kNwA5fIXq", "livemode": false, "metadata": {}, "on_behalf_of": null, "order": null, "outcome": {"network_status": "approved_by_network", "reason": null, "risk_level": "normal", "risk_score": 44, "seller_message": "Payment complete.", "type": "authorized"}, "paid": true, "payment_intent": "pi_3P5EmzIfR5z29g5k0uVvI3kX", "payment_method": "pm_1P5EmyIfR5z29g5kAIZoJcSv", "payment_method_details": {"card": {"amount_authorized": 2500, "brand": "visa", "checks": {"address_line1_check": null, "address_postal_code_check": "pass", "cvc_check": "pass"}, "country": "US", "exp_month": 12, "exp_year": 2050, "extended_authorization": {"status": "disabled"}, "fingerprint": "2uVHwVtZ157kRjpi", "funding": "credit", "incremental_authorization": {"status": "unavailable"}, "installments": null, "last4": "4242", "mandate": null, "multicapture": {"status": "unavailable"}, "network": "visa", "network_token": {"used": false}, "overcapture": {"maximum_amount_capturable": 2500, "status": "unavailable"}, "three_d_secure": null, "wallet": null}, "type": "card"}, "radar_options": {}, "receipt_email": "aapeli@couchers.org", "receipt_number": null, "receipt_url": "https://pay.stripe.com/receipts/invoices/CAcaFwoVYWNjdF8xS0V6QnlJZlI1ejI5ZzVrKIOG7LAGMgYTBIebo2c6LBYFs4BgdV7T4S5nHXQyHt4uh5azZ3_ss_S2wi27m52wbg4yQAoirZ9eBhbH?s=ap", "refunded": false, "review": null, "shipping": null, "source": null, "source_transfer": null, "statement_descriptor": null, "statement_descriptor_suffix": null, "status": "succeeded", "transfer_data": null, "transfer_group": null}}, "livemode": false, "pending_webhooks": 2, "request": {"id": "req_x1PqgmCHBOPD0i", "idempotency_key": "44ec8acd-be18-4de0-af2e-715760e96725"}, "type": "charge.succeeded"}',
    "evt_3P5EmzIfR5z29g5k0bxxQl9f": '{"id": "evt_3P5EmzIfR5z29g5k0bxxQl9f", "object": "event", "api_version": "2024-04-10", "created": 1713046273, "data": {"object": {"id": "pi_3P5EmzIfR5z29g5k0uVvI3kX", "object": "payment_intent", "amount": 2500, "amount_capturable": 0, "amount_details": {"tip": {}}, "amount_received": 0, "application": null, "application_fee_amount": null, "automatic_payment_methods": null, "canceled_at": null, "cancellation_reason": null, "capture_method": "automatic", "client_secret": "pi_3P5EmzIfR5z29g5k0uVvI3kX_secret_mw1JYS1lig6dYcy922zoeyzkK", "confirmation_method": "automatic", "created": 1713046273, "currency": "usd", "customer": "cus_Pv4w8dxBpTVUsQ", "description": "Subscription creation", "invoice": "in_1P5EmzIfR5z29g5kNwA5fIXq", "last_payment_error": null, "latest_charge": null, "livemode": false, "metadata": {}, "next_action": null, "on_behalf_of": null, "payment_method": null, "payment_method_configuration_details": null, "payment_method_options": {"card": {"installments": null, "mandate_options": null, "network": null, "request_three_d_secure": "automatic"}, "cashapp": {}}, "payment_method_types": ["card", "cashapp"], "processing": null, "receipt_email": "aapeli@couchers.org", "review": null, "setup_future_usage": "off_session", "shipping": null, "source": null, "statement_descriptor": null, "statement_descriptor_suffix": null, "status": "requires_payment_method", "transfer_data": null, "transfer_group": null}}, "livemode": false, "pending_webhooks": 2, "request": {"id": "req_x1PqgmCHBOPD0i", "idempotency_key": "44ec8acd-be18-4de0-af2e-715760e96725"}, "type": "payment_intent.created"}',
    "evt_3P5EmzIfR5z29g5k0taFsMsl": '{"id": "evt_3P5EmzIfR5z29g5k0taFsMsl", "object": "event", "api_version": "2024-04-10", "created": 1713046274, "data": {"object": {"id": "pi_3P5EmzIfR5z29g5k0uVvI3kX", "object": "payment_intent", "amount": 2500, "amount_capturable": 0, "amount_details": {"tip": {}}, "amount_received": 2500, "application": null, "application_fee_amount": null, "automatic_payment_methods": null, "canceled_at": null, "cancellation_reason": null, "capture_method": "automatic", "client_secret": "pi_3P5EmzIfR5z29g5k0uVvI3kX_secret_mw1JYS1lig6dYcy922zoeyzkK", "confirmation_method": "automatic", "created": 1713046273, "currency": "usd", "customer": "cus_Pv4w8dxBpTVUsQ", "description": "Subscription creation", "invoice": "in_1P5EmzIfR5z29g5kNwA5fIXq", "last_payment_error": null, "latest_charge": "ch_3P5EmzIfR5z29g5k05Mw6ZV2", "livemode": false, "metadata": {}, "next_action": null, "on_behalf_of": null, "payment_method": "pm_1P5EmyIfR5z29g5kAIZoJcSv", "payment_method_configuration_details": null, "payment_method_options": {"card": {"installments": null, "mandate_options": null, "network": null, "request_three_d_secure": "automatic", "setup_future_usage": "off_session"}, "cashapp": {}}, "payment_method_types": ["card", "cashapp"], "processing": null, "receipt_email": "aapeli@couchers.org", "review": null, "setup_future_usage": "off_session", "shipping": null, "source": null, "statement_descriptor": null, "statement_descriptor_suffix": null, "status": "succeeded", "transfer_data": null, "transfer_group": null}}, "livemode": false, "pending_webhooks": 3, "request": {"id": "req_x1PqgmCHBOPD0i", "idempotency_key": "44ec8acd-be18-4de0-af2e-715760e96725"}, "type": "payment_intent.succeeded"}',
}

one_time_STRIPE_SESSION = json.loads(
    '{"id": "cs_test_a12ftevGwzCAa236NeLPq6yRAdMt0V2S1gGjFcxfsY4xT4tiREPvbr5lhG", "object": "checkout.session", "after_expiration": null, "allow_promotion_codes": null, "amount_subtotal": 10000, "amount_total": 10000, "automatic_tax": {"enabled": false, "liability": null, "status": null}, "billing_address_collection": null, "cancel_url": "http://localhost:3000/donate?cancelled=true", "client_reference_id": "1", "client_secret": null, "consent": null, "consent_collection": null, "created": 1713046124, "currency": "usd", "currency_conversion": null, "custom_fields": [], "custom_text": {"after_submit": null, "shipping_address": null, "submit": null, "terms_of_service_acceptance": null}, "customer": "cus_Pv4uq0gT0rDZWN", "customer_creation": null, "customer_details": {"address": null, "email": "aapeli@couchers.org", "name": null, "phone": null, "tax_exempt": "none", "tax_ids": null}, "customer_email": null, "expires_at": 1713132523, "invoice": null, "invoice_creation": {"enabled": false, "invoice_data": {"account_tax_ids": null, "custom_fields": null, "description": null, "footer": null, "issuer": null, "metadata": {}, "rendering_options": null}}, "livemode": false, "locale": null, "metadata": {}, "mode": "payment", "payment_intent": null, "payment_link": null, "payment_method_collection": "if_required", "payment_method_configuration_details": null, "payment_method_options": {"card": {"request_three_d_secure": "automatic"}}, "payment_method_types": ["card"], "payment_status": "unpaid", "phone_number_collection": {"enabled": false}, "recovered_from": null, "setup_intent": null, "shipping_address_collection": null, "shipping_cost": null, "shipping_details": null, "shipping_options": [], "status": "open", "submit_type": "donate", "subscription": null, "success_url": "http://localhost:3000/donate?success=true", "total_details": {"amount_discount": 0, "amount_shipping": 0, "amount_tax": 0}, "ui_mode": "hosted", "url": "https://checkout.stripe.com/c/pay/cs_test_a12ftevGwzCAa236NeLPq6yRAdMt0V2S1gGjFcxfsY4xT4tiREPvbr5lhG#fidkdWxOYHwnPyd1blpxYHZxWjA0TkB%2FR3xMY1cwfzc8YjBua0NNSEZjVUhUd2h%2FYW1yQGlLaU9tXVNoMVE3ZE1QQEluajNiS3xEaVxxQ3xXT1J%2FU3dWb3NhSUhIf2tXTmpVNUpUMzJDaGZLNTVVTmhTcEJocycpJ2N3amhWYHdzYHcnP3F3cGApJ2lkfGpwcVF8dWAnPyd2bGtiaWBabHFgaCcpJ2BrZGdpYFVpZGZgbWppYWB3dic%2FcXdwYHgl"}'
)
RECURRING_STRIPE_SESSION = json.loads(
    '{"id": "cs_test_a1JoMu1FbksL058ob6T6AC1byYR2DCXVRwi0ybLSZKwINYe868OQr25qaC", "object": "checkout.session", "after_expiration": null, "allow_promotion_codes": null, "amount_subtotal": 2500, "amount_total": 2500, "automatic_tax": {"enabled": false, "liability": null, "status": null}, "billing_address_collection": null, "cancel_url": "http://localhost:3000/donate?cancelled=true", "client_reference_id": "1", "client_secret": null, "consent": null, "consent_collection": null, "created": 1713046244, "currency": "usd", "currency_conversion": null, "custom_fields": [], "custom_text": {"after_submit": null, "shipping_address": null, "submit": null, "terms_of_service_acceptance": null}, "customer": "cus_Pv4w8dxBpTVUsQ", "customer_creation": null, "customer_details": {"address": null, "email": "aapeli@couchers.org", "name": null, "phone": null, "tax_exempt": "none", "tax_ids": null}, "customer_email": null, "expires_at": 1713132644, "invoice": null, "invoice_creation": null, "livemode": false, "locale": null, "metadata": {}, "mode": "subscription", "payment_intent": null, "payment_link": null, "payment_method_collection": "always", "payment_method_configuration_details": null, "payment_method_options": {"card": {"request_three_d_secure": "automatic"}}, "payment_method_types": ["card"], "payment_status": "unpaid", "phone_number_collection": {"enabled": false}, "recovered_from": null, "setup_intent": null, "shipping_address_collection": null, "shipping_cost": null, "shipping_details": null, "shipping_options": [], "status": "open", "submit_type": null, "subscription": null, "success_url": "http://localhost:3000/donate?success=true", "total_details": {"amount_discount": 0, "amount_shipping": 0, "amount_tax": 0}, "ui_mode": "hosted", "url": "https://checkout.stripe.com/c/pay/cs_test_a1JoMu1FbksL058ob6T6AC1byYR2DCXVRwi0ybLSZKwINYe868OQr25qaC#fid2cGd2ZndsdXFsamtQa2x0cGBrYHZ2QGtkZ2lgYSc%2FY2RpdmApJ2R1bE5gfCc%2FJ3VuWnFgdnFaMDROQH9HfExjVzB%2FNzxiMG5rQ01IRmNVSFR3aH9hbXJAaUtpT21dU2gxUTdkTVBASW5qM2JLfERpXHFDfFdPUn9Td1Zvc2FJSEh%2Fa1dOalU1SlQzMkNoZks1NVVOaFNwQmhzJyknY3dqaFZgd3Ngdyc%2FcXdwYCknaWR8anBxUXx1YCc%2FJ3Zsa2JpYFpscWBoJyknYGtkZ2lgVWlkZmBtamlhYHd2Jz9xd3BgeCUl"}'
)
