# List the start up tasks. Learn more https://www.gitpod.io/docs/config-start-tasks/
tasks:
  - name: Compile the protocol buffers, launch the backend with docker-compose
    before: cd app
    init: |
      docker run --rm -w /app -v $(pwd):/app couchers/grpc ./generate_protos.sh
      docker-compose up --build

  - name: install and launch the frontend with yarn
    before: cd app/frontend
    init: yarn install
    command: REACT_APP_API_BASE_URL=$(gp url 8888) yarn start

# List the ports to expose. Learn more https://www.gitpod.io/docs/config-ports/
ports:
  - port: 3000
    onOpen: open-preview
  - port: 8888
